
import time
import logging
import json
import datetime
from PyCampbellCR1000.pycampbellcr1000.exceptions import NoDeviceException

logging.basicConfig(level=logging.DEBUG)
logging.getLogger('pycampbellcr1000').setLevel(logging.INFO)
logging.getLogger('pylink').setLevel(logging.WARN)

from PyCampbellCR1000.pycampbellcr1000 import CR1000


device = None

#while device == None:
if device == None:
    try:
        print("creating device.")
        
        # or with Serial connection
        #device = CR1000.from_url('serial:/dev/ttyUSB0:38400',
        device = CR1000.from_url('serial:/dev/ttyACM0:57600',
                                 src_addr=4004,
                                 #src_addr=4003,                         
                                 dest_addr=1235,
                                 #dest_addr=1234,
                                 timeout=1)
        
        #print (device.gettime())
        
        print ('have device: {}'.format(device))
        
        
        if 0:
            td = device.table_def
            
            print ("tabledef: " + str(td))
            
            print ('tables:')
            
            for t in td:
                print (t)
            with open ('devices/{}.json'.format(device.serialNo), 'w') as f:
                json.dump(td, f, indent=2, sort_keys=True)
     
            
        """
        {'Signature': 1747, 'Fields': [{'FieldName': b'OSVersion', 'Dimension': 32, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [32], 'Processing': b'', 'Units': b''}, {'FieldName': b'OSDate', 'Dimension': 12, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [12], 'Processing': b'', 'Units': b''}, {'FieldName': b'OSSignature', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'SerialNumber', 'Dimension': 8, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [8], 'Processing': b'', 'Units': b''}, {'FieldName': b'RevBoard', 'Dimension': 8, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [8], 'Processing': b'', 'Units': b''}, {'FieldName': b'StationName', 'Dimension': 64, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [64], 'Processing': b'', 'Units': b''}, {'FieldName': b'ProgName', 'Dimension': 64, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [64], 'Processing': b'', 'Units': b''}, {'FieldName': b'StartTime', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'NSec', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'RunSignature', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'ProgSignature', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'WatchdogErrors', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'PanelTemp', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'DegC'}, {'FieldName': b'Battery', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'Volts'}, {'FieldName': b'LithiumBattery', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'Volts'}, {'FieldName': b'PowerSource', 'Dimension': 8, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [8], 'Processing': b'', 'Units': b''}, {'FieldName': b'ChargeInput', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'Volts'}, {'FieldName': b'ChargeState', 'Dimension': 20, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [20], 'Processing': b'', 'Units': b''}, {'FieldName': b'Low12VCount', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'CompileResults', 'Dimension': 256, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [256], 'Processing': b'', 'Units': b''}, {'FieldName': b'StartUpCode', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'ProgErrors', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'VarOutOfBound', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'SkippedScan', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'SkippedSystemScan', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'ErrorCalib', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'MemorySize', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'bytes'}, {'FieldName': b'MemoryFree', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'bytes'}, {'FieldName': b'CommsMemFree', 'Dimension': 48, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [48], 'Processing': b'', 'Units': b''}, {'FieldName': b'FullMemReset', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'CardStatus', 'Dimension': 80, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [80], 'Processing': b'', 'Units': b''}, {'FieldName': b'MeasureOps', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'MeasureTime', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'usec'}, {'FieldName': b'ProcessTime', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'usec'}, {'FieldName': b'MaxProcTime', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'usec'}, {'FieldName': b'BuffDepth', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'scans'}, {'FieldName': b'MaxBuffDepth', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'scans'}, {'FieldName': b'LastSystemScan', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'NSec', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'SystemProcTime', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'usec'}, {'FieldName': b'MaxSystemProcTime', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'usec'}, {'FieldName': b'PortStatus', 'Dimension': 4, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Bool4', 'BegIdx': 1, 'SubDim': [4], 'Processing': b'', 'Units': b''}, {'FieldName': b'PortConfig', 'Dimension': 32, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [4, 8], 'Processing': b'', 'Units': b''}, {'FieldName': b'SW12Volts', 'Dimension': 2, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Bool4', 'BegIdx': 1, 'SubDim': [2], 'Processing': b'', 'Units': b''}, {'FieldName': b'PakBusRoutes', 'Dimension': 256, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [256], 'Processing': b'', 'Units': b''}, {'FieldName': b'Messages', 'Dimension': 256, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [256], 'Processing': b'', 'Units': b''}, {'FieldName': b'CalVolts', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [3], 'Processing': b'', 'Units': b'mVolts'}, {'FieldName': b'CalGain', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [3], 'Processing': b'', 'Units': b''}, {'FieldName': b'CalOffset', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [3], 'Processing': b'', 'Units': b''}, {'FieldName': b'IxResistor', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}], 'Header': {'TimeType': 14, 'TableName': b'Status', 'TblTimeInto': (0, 0), 'TblInterval': (0, 0), 'TableSize': 1}}
{'Signature': 63884, 'Fields': [{'FieldName': b'battV', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b''}, {'FieldName': b'pTemp', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b''}, {'FieldName': b'VWPbUnits', 'Dimension': 9, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [9], 'Processing': b'Smp', 'Units': 66}, {'FieldName': b'VWPkPa', 'Dimension': 9, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [9], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'VWPtherm', 'Dimension': 9, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [9], 'Processing': b'Smp', 'Units': b'\xc2\xb0C'}], 'Header': {'TimeType': 14, 'TableName': b'WO209060_VWP', 'TblTimeInto': (0, 0), 'TblInterval': (0, 0), 'TableSize': 7440}}
{'Signature': 30052, 'Fields': [{'FieldName': b'battV', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b''}, {'FieldName': b'pTemp', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b''}, {'FieldName': b'VWPIPbUnits', 'Dimension': 2, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [2], 'Processing': b'Smp', 'Units': 66}, {'FieldName': b'VWPIPkpa', 'Dimension': 2, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [2], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'VWPIPtherm', 'Dimension': 2, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [2], 'Processing': b'Smp', 'Units': b'\xc2\xb0C'}], 'Header': {'TimeType': 14, 'TableName': b'WO209060_VWPIP', 'TblTimeInto': (0, 0), 'TblInterval': (0, 0), 'TableSize': 7440}}
{'Signature': 38686, 'Fields': [{'FieldName': b'battV', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b''}, {'FieldName': b'pTemp', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b''}, {'FieldName': b'barokPa', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'pbmVWPbUnits', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [4], 'Processing': b'Smp', 'Units': 66}, {'FieldName': b'pbmTEPCbUnits', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [12], 'Processing': b'Smp', 'Units': 66}, {'FieldName': b'pbmVWPkPa', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [4], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'pbmTEPCkPa', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [12], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'pbmVWPtherm', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [4], 'Processing': b'Smp', 'Units': b'\xc2\xb0C'}, {'FieldName': b'pbmHeading_1', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmPitch_1', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmRoll_1', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmVWPbUnits', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 2, 'SubDim': [4], 'Processing': b'Smp', 'Units': 66}, {'FieldName': b'pbmTEPCbUnits', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 4, 'SubDim': [12], 'Processing': b'Smp', 'Units': 66}, {'FieldName': b'pbmVWPkPa', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 2, 'SubDim': [4], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'pbmTEPCkPa', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 4, 'SubDim': [12], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'pbmVWPtherm', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 2, 'SubDim': [4], 'Processing': b'Smp', 'Units': b'\xc2\xb0C'}, {'FieldName': b'pbmHeading_2', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmPitch_2', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmRoll_2', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmVWPbUnits', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 3, 'SubDim': [4], 'Processing': b'Smp', 'Units': 66}, {'FieldName': b'pbmTEPCbUnits', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 7, 'SubDim': [12], 'Processing': b'Smp', 'Units': 66}, {'FieldName': b'pbmVWPkPa', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 3, 'SubDim': [4], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'pbmTEPCkPa', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 7, 'SubDim': [12], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'pbmVWPtherm', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 3, 'SubDim': [4], 'Processing': b'Smp', 'Units': b'\xc2\xb0C'}, {'FieldName': b'pbmHeading_3', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmPitch_3', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmRoll_3', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmVWPbUnits', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 4, 'SubDim': [4], 'Processing': b'Smp', 'Units': 66}, {'FieldName': b'pbmTEPCbUnits', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 10, 'SubDim': [12], 'Processing': b'Smp', 'Units': 66}, {'FieldName': b'pbmVWPkPa', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 4, 'SubDim': [4], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'pbmTEPCkPa', 'Dimension': 3, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 10, 'SubDim': [12], 'Processing': b'Smp', 'Units': b'kPa'}, {'FieldName': b'pbmVWPtherm', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 4, 'SubDim': [4], 'Processing': b'Smp', 'Units': b'\xc2\xb0C'}, {'FieldName': b'pbmHeading_4', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmPitch_4', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmRoll_4', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b'\xc2\xb0'}], 'Header': {'TimeType': 14, 'TableName': b'WO209060_PBM', 'TblTimeInto': (0, 0), 'TblInterval': (0, 0), 'TableSize': 7440}}
{'Signature': 3523, 'Fields': [{'FieldName': b'battV', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b''}, {'FieldName': b'pTemp', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Smp', 'Units': b''}, {'FieldName': b'SMTraw', 'Dimension': 10, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [10], 'Processing': b'Smp', 'Units': b'mA'}, {'FieldName': b'SMTkPa', 'Dimension': 10, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Smp', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [10], 'Processing': b'Smp', 'Units': b'kPa'}], 'Header': {'TimeType': 14, 'TableName': b'WO209060_SMT', 'TblTimeInto': (0, 0), 'TblInterval': (0, 0), 'TableSize': 7440}}
{'Signature': 59136, 'Fields': [{'FieldName': b'rainmm_Tot', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Tot', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Tot', 'Units': b'mm'}, {'FieldName': b'airTemp_Avg', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Avg', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Avg', 'Units': b'\xc2\xb0C'}, {'FieldName': b'relHumidity_Avg', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Avg', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Avg', 'Units': 37}, {'FieldName': b'barokPa_Avg', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Avg', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Avg', 'Units': b'kPa'}], 'Header': {'TimeType': 14, 'TableName': b'WeatherStationDaily', 'TblTimeInto': (0, 0), 'TblInterval': (0, 0), 'TableSize': 5}}
{'Signature': 64861, 'Fields': [{'FieldName': b'rainmm_Tot', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Tot', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Tot', 'Units': b'mm'}, {'FieldName': b'airTemp_Avg', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Avg', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Avg', 'Units': b'\xc2\xb0C'}, {'FieldName': b'relHumidity_Avg', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Avg', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Avg', 'Units': 37}, {'FieldName': b'barokPa_Avg', 'Dimension': 1, 'ReadOnly': 1, 'AliasName': [], 'Description': b'Avg', 'FieldType': 'FP2', 'BegIdx': 1, 'SubDim': [], 'Processing': b'Avg', 'Units': b'kPa'}], 'Header': {'TimeType': 14, 'TableName': b'WeatherStationHourly', 'TblTimeInto': (0, 0), 'TblInterval': (0, 0), 'TableSize': 124}}
{'Signature': 55608, 'Fields': [{'FieldName': b'DataTableName', 'Dimension': 144, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [6, 24], 'Processing': b'', 'Units': b''}, {'FieldName': b'SkippedRecord', 'Dimension': 6, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [6], 'Processing': b'', 'Units': b''}, {'FieldName': b'DataRecordSize', 'Dimension': 12, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'Int4', 'BegIdx': 1, 'SubDim': [6, 2], 'Processing': b'', 'Units': b'records'}, {'FieldName': b'SecsPerRecord', 'Dimension': 6, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [6], 'Processing': b'', 'Units': b''}, {'FieldName': b'DataFillDays', 'Dimension': 12, 'ReadOnly': 1, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [6, 2], 'Processing': b'', 'Units': b'days'}], 'Header': {'TimeType': 14, 'TableName': b'DataTableInfo', 'TblTimeInto': (0, 0), 'TblInterval': (0, 0), 'TableSize': 1}}
{'Signature': 39875, 'Fields': [{'FieldName': b'VWPbUnits', 'Dimension': 9, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [9], 'Processing': b'', 'Units': 66}, {'FieldName': b'VWPkPa', 'Dimension': 9, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [9], 'Processing': b'', 'Units': b'kPa'}, {'FieldName': b'VWPtherm', 'Dimension': 9, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [9], 'Processing': b'', 'Units': b'\xc2\xb0C'}, {'FieldName': b'VWPIPbUnits', 'Dimension': 2, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [2], 'Processing': b'', 'Units': 66}, {'FieldName': b'VWPIPkpa', 'Dimension': 2, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [2], 'Processing': b'', 'Units': b'kPa'}, {'FieldName': b'VWPIPtherm', 'Dimension': 2, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [2], 'Processing': b'', 'Units': b'\xc2\xb0C'}, {'FieldName': b'pbmVWPbUnits', 'Dimension': 4, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [4], 'Processing': b'', 'Units': 66}, {'FieldName': b'pbmVWPkPa', 'Dimension': 4, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [4], 'Processing': b'', 'Units': b'kPa'}, {'FieldName': b'pbmVWPtherm', 'Dimension': 4, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [4], 'Processing': b'', 'Units': b'\xc2\xb0C'}, {'FieldName': b'pbmTEPCbUnits', 'Dimension': 12, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [12], 'Processing': b'', 'Units': 66}, {'FieldName': b'pbmTEPCkPa', 'Dimension': 12, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [12], 'Processing': b'', 'Units': b'kPa'}, {'FieldName': b'pbmHeading_1', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmPitch_1', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmRoll_1', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmHeading_2', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmPitch_2', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmRoll_2', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmHeading_3', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmPitch_3', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmRoll_3', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmHeading_4', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmPitch_4', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'pbmRoll_4', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0'}, {'FieldName': b'SMTraw', 'Dimension': 10, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [10], 'Processing': b'', 'Units': b'mA'}, {'FieldName': b'SMTkPa', 'Dimension': 10, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [10], 'Processing': b'', 'Units': b'kPa'}, {'FieldName': b'rainmm', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'mm'}, {'FieldName': b'airTemp', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'\xc2\xb0C'}, {'FieldName': b'relHumidity', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': 37}, {'FieldName': b'baroRaw', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'barokPa', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b'kPa'}, {'FieldName': b'battV', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'pTemp', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'fastScan', 'Dimension': 1, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'Bool4', 'BegIdx': 1, 'SubDim': [], 'Processing': b'', 'Units': b''}, {'FieldName': b'Htz', 'Dimension': 27, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [27], 'Processing': b'', 'Units': b''}, {'FieldName': b'Amp', 'Dimension': 27, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [27], 'Processing': b'', 'Units': b''}, {'FieldName': b'S2N', 'Dimension': 27, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [27], 'Processing': b'', 'Units': b''}, {'FieldName': b'NF', 'Dimension': 27, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [27], 'Processing': b'', 'Units': b''}, {'FieldName': b'DR', 'Dimension': 27, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [27], 'Processing': b'', 'Units': b''}, {'FieldName': b'Tmp', 'Dimension': 27, 'ReadOnly': 0, 'AliasName': [], 'Description': b'', 'FieldType': 'IEEE4B', 'BegIdx': 1, 'SubDim': [27], 'Processing': b'', 'Units': b''}, {'FieldName': b'VWwT', 'Dimension': 68, 'ReadOnly': 0, 'AliasName': [], 'Description': b'VW,0,0,1', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [68], 'Processing': b'VW,0,0,1', 'Units': b''}, {'FieldName': b'VWwoT', 'Dimension': 68, 'ReadOnly': 0, 'AliasName': [], 'Description': b'VW,0,0,1', 'FieldType': 'ASCII', 'BegIdx': 1, 'SubDim': [68], 'Processing': b'VW,0,0,1', 'Units': b''}], 'Header': {'TimeType': 14, 'TableName': b'Public', 'TblTimeInto': (0, 0), 'TblInterval': (0, 0), 'TableSize': 1}}

"""
        
        #print ("tabledef:")
        #for t in device.table_def:
        #   print(t)
        
        if 0:
            while True:
                hdr, msg = device.wait_for_message(90)
                
                if msg and msg != {}:
                    print ("got data: {}".format(msg))
                else:
                    ping = False
                    while not ping:
                        try:
                            device.ping_node()
                            ping = True
                        except NoDeviceException:
                            print ("no ping response, retry.")
        
        if 1:            
            print ("time: {}".format(device.gettime()))
            tlist =['WO209060_VWP', 'WO209060_VWPIP', 'WO209060_PBM', 'WO209060_SMT', 'WeatherStationDaily', 'WeatherStationHourly']
            #for tablename in device.list_tables():
            for tablename in tlist:
                  
                filename = tablename + ".csv"
                print("Download {} to {}".format(tablename, filename))
                
                for items in device.get_data_generator(tablename, 
                                                       start_date = datetime.datetime.now() - datetime.timedelta(seconds=600)):
                    print(items.to_csv())
                    #for record in items:
                    #    print("got record: {}".format(record))
    
    except NoDeviceException:
        print ("No response, delay and retry.")
        time.sleep(1)
        